<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de Stock ‚Äî Mundo In</title>
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
:root{
  --brand:#184E56;
  --excel-green:#107c41;
  --border:#d1d5db;
  --header-bg:#f3f4f6;
  --selection:#e7f3f0;
}
body{
  font-family:'Segoe UI',sans-serif;
  margin:0;
  height:100vh;
  display:flex;
  flex-direction:column;
}
nav{
  background:var(--brand);
  color:#fff;
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.search-excel{
  width:320px;
  padding:8px 12px;
  border-radius:6px;
  border:none;
  outline:none;
}
.toolbar{
  padding:8px 20px;
  border-bottom:1px solid var(--border);
  display:flex;
  gap:20px;
  align-items:center;
}
.btn-save-main{
  color:var(--excel-green);
  cursor:pointer;
  display:flex;
  gap:6px;
  align-items:center;
}
.grid-container{
  flex:1;
  overflow:auto;
}
table{
  border-collapse:collapse;
  min-width:100%;
}
th,td{
  border:1px solid var(--border);
}
th{
  background:var(--header-bg);
  padding:10px;
  font-size:11px;
  text-transform:uppercase;
}
td{
  padding:0;
}
.cell-input{
  width:100%;
  height:38px;
  border:none;
  padding:0 10px;
  text-align:center;
}
.cell-input:focus{
  outline:2px solid var(--excel-green);
}
tr:hover td{
  background:var(--selection);
}
.toast{
  position:fixed;
  bottom:25px;
  right:25px;
  background:#1f2937;
  color:#fff;
  padding:12px 18px;
  border-radius:8px;
  display:none;
  gap:8px;
  align-items:center;
}
</style>
</head>

<body>

<nav>
  <div style="display:flex;gap:15px;align-items:center">
    <img src="https://cdn.shopify.com/s/files/1/1233/2374/files/Frame_2_1.png" width="110">
    <strong>CONTROL DE INVENTARIO</strong>
  </div>
  <input class="search-excel" placeholder="üîç Buscar SKU o producto">
</nav>

<div class="toolbar">
  <div class="btn-save-main" onclick="guardar()">
    <i class="ph-fill ph-floppy-disk"></i> Guardar cambios
  </div>
  <div style="margin-left:auto;color:#059669;font-weight:600">
    ‚óè Conectado a Shopify
  </div>
</div>

<div class="grid-container">
<table>
<thead>
<tr>
  <th>SKU</th>
  <th>Producto</th>
  <th>Variante</th>
  <th>Centro</th>
  <th>Coyoac√°n</th>
  <th>Benito J.</th>
  <th>Gustavo Baz</th>
  <th>Naucalpan</th>
  <th>Toluca</th>
  <th>Quer√©taro</th>
  <th>Vallejo</th>
  <th>Puebla</th>
</tr>
</thead>
<tbody id="fila"></tbody>
</table>
</div>

<div id="toast" class="toast">
  <i class="ph ph-check-circle" style="color:#22c55e"></i>
  <span>Guardado correctamente</span>
</div>

<script>
const HANDLE = 'cama-luton';

const SUCURSALES = [
  'stock_centro',
  'suc_coyoacan',
  'suc_benito_juarez',
  'suc_gustavo_baz',
  'suc_naucalpan',
  'suc_toluca',
  'suc_queretaro',
  'suc_vallejo',
  'suc_puebla'
];

async function cargar(){
  const res = await fetch(`/api/metafield?handle=${HANDLE}`);
  const json = await res.json();

  const stocks = json.stocks || {};

  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="cell-input" value="RECA0904851" readonly></td>
    <td><input class="cell-input" value="Cama Luton Gris" readonly></td>
    <td><input class="cell-input" value="Individual" readonly></td>
    ${SUCURSALES.map(k => `
      <td>
        <input 
          class="cell-input" 
          data-key="${k}" 
          type="number" 
          min="0"
          value="${stocks[k] ?? 0}">
      </td>
    `).join('')}
  `;

  fila.innerHTML = '';
  fila.appendChild(tr);
}

async function guardar(){
  const stocks = {};
  document.querySelectorAll('[data-key]').forEach(i=>{
    stocks[i.dataset.key] = Number(i.value) || 0;
  });

  await fetch('/api/metafield', {
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify({ handle: HANDLE, stocks })
  });

  toast.style.display='flex';
  setTimeout(()=>toast.style.display='none',2000);
}

window.onload = cargar;
</script>

</body>
</html>
