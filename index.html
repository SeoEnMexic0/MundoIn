<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cama Luton — Stock por Sucursal</title>
<style>
  :root {
    --bg: #0f172a;
    --panel: #1e293b;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --primary: #22c55e;
    --border: #334155;
    --input-bg: #1e293b;
  }

  * { box-sizing: border-box; font-family: system-ui, sans-serif; }
  body { margin:0; background: var(--bg); color: var(--text); display:flex; justify-content:center; align-items:flex-start; min-height:100vh; padding:2rem; }
  .container { width:100%; max-width:720px; }

  h1 { font-size:2rem; margin-bottom:0.5rem; color: var(--primary); text-align:center; }
  p.desc { text-align:center; color: var(--muted); margin-bottom:2rem; }

  table { width:100%; border-collapse:collapse; background: var(--panel); border-radius:12px; overflow:hidden; box-shadow:0 10px 20px rgba(0,0,0,0.3); }
  th, td { padding:10px; border-bottom:1px solid var(--border); text-align:center; }
  th { background: #1f2937; color: var(--primary); }
  td input { width:60px; padding:5px; border-radius:6px; border:none; text-align:center; background: var(--input-bg); color: var(--text); }

  button {
    display:block;
    margin:1.5rem auto 0;
    padding:12px 24px;
    font-size:1rem;
    font-weight:600;
    border:none;
    border-radius:12px;
    background: linear-gradient(180deg, var(--primary), #16a34a);
    color:#fff;
    cursor:pointer;
    transition:0.2s;
  }
  button:hover { filter:brightness(1.1); }
  button:disabled { opacity:0.6; cursor:not-allowed; }

  .note { margin-top:1rem; padding:10px 15px; border-left:4px solid var(--primary); background:#111827; color:var(--muted); border-radius:8px; font-size:0.9rem; }
</style>
</head>
<body>

<div class="container">
  <h1>Cama Luton — Individual / Gris</h1>
  <p class="desc">Consulta y actualiza el stock por sucursal en tiempo real</p>

  <table id="tabla">
    <thead>
      <tr>
        <th>Sucursal</th>
        <th>Stock actual</th>
        <th>Nuevo</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="guardarBtn">Guardar cambios</button>
  <div class="note">Solo se actualiza la "Cama Luton". Los cambios se reflejan al instante.</div>
</div>

<script>
const HANDLE = 'cama-luton';
const tbody = document.querySelector('#tabla tbody');
const btn = document.getElementById('guardarBtn');
const SUCURSAL = 'Benito Juárez';

async function cargarStock() {
  tbody.innerHTML = '<tr><td colspan="3">Cargando stock...</td></tr>';

  try {
    const res = await fetch(`/api/metafield?handle=${HANDLE}`);
    const data = await res.json();
    if(!data.ok) throw new Error(data.error || 'Error al cargar stock');

    tbody.innerHTML = `
      <tr>
        <td>${SUCURSAL}</td>
        <td>${data.stock}</td>
        <td><input type="number" data-suc="${SUCURSAL}" placeholder="=" min="0"></td>
      </tr>
    `;
  } catch(e) {
    tbody.innerHTML = `<tr><td colspan="3">❌ Error: ${e.message}</td></tr>`;
  }
}

async function guardar() {
  const input = document.querySelector(`input[data-suc="${SUCURSAL}"]`);
  const cantidad = Number(input.value || 0);

  if(input.value === ''){
    alert('No hay cantidad para guardar.');
    return;
  }

  btn.disabled = true;
  btn.textContent = 'Guardando...';

  try {
    const res = await fetch('/api/metafield', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        handle: HANDLE,
        cantidad: cantidad
      })
    });

    const data = await res.json();
    if(!data.ok) throw new Error(data.error || 'Error al guardar');

    alert('✔ Stock actualizado correctamente!');
    cargarStock(); // refresca tabla en tiempo real
    input.value = '';
  } catch(e) {
    alert('✗ Error: '+e.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'Guardar cambios';
  }
}

btn.addEventListener('click', guardar);
window.addEventListener('load', cargarStock);
</script>

</body>
</html>
